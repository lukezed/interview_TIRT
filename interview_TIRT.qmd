---
title: "Interview - Developmental Milestone Project"
subtitle: "How to Measure Parents' Developmental Foci: Domains and Methodologies"
author: "Chi Zhang"
institute: the University of Manchester
date: today
date-format: "dddd, [the] D[<sup style='font-size:65%;font-style:italic;'>th</sup>] [of] MMMM, YYYY"
bibliography: bib/template.bib
format:
  dime-revealjs:
    embed-resources: true
    footer: " "
    self-contained-math: false
    output-file: index.html
    toc: true
    toc-depth: 1
    toc-title: "Contents"
    preview-links: false

    html-math-method: mathjax
editor: 
  markdown: 
    wrap: 72
---

```{r Setup}
#| include: false
# Add default ggplot theme. This can be overridden by your own theme at
# the end of the ggplot graph.

# DIME:
source("_extensions/dime-worldbank/dime/setup_dime_palettes.R")
source("_extensions/dime-worldbank/dime/setup_ggplot2_dime.R")

if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  dplyr, DT, ggplot2, ggpubr, ggrepel, ggtext, gt, here, huxtable, 
  knitr, leaflet, osmdata, pacman, pagedown, palmerpenguins,
  reactable, sf, tidyr, tidyverse, brms, rstan, patchwork
)
```

## About me

-   **PhD in Education**, The University of Manchester (2021–Present);\
    *From belief to practice: Understanding teachers’ pedagogic choices
    in China’s mathematics education*

-   **MSc in Research Methods with Education** (Distinction,
    2020–2021);\
    *The association between mathematics teachers’ exclusivity belief
    and pedagogic practice*

-   **MA in Mathematics and Pedagogy**, The Education University of Hong
    Kong (2019–2020)

## Interview question

1.  How can one assess parents' developmental foci in a cross-cultural
    context? With developmental foci, we mean the domain (e.g.
    linguistic, social, physical, etc.) of a child’s development that is
    of particular importance to parents.
2.  Think about two communities (could be Germany and Namibia, but also
    other contexts you have experience with) and formulate hypotheses
    regarding potential differences in developmental foci.

# The basic IRT assumptions {background-color="#07202E"}

## Bullets

When you click the **Render** button a document will be generated that
includes:

-   Content authored with markdown
-   Output from executable code

> This is part of the [Quarto
> documentation](https://quarto.org/docs/presentations/).

## R Code

When you click the **Render** button a presentation will be generated
that includes both content and the output of embedded code. You can
embed code like this:

```{r mini_code_test}
#| echo: true
1 + 1
```

> This is part of the [Quarto
> documentation](https://quarto.org/docs/presentations/).

You can also add `text marked as code`!

## Equations

Adding Latex style equations is straightforward. Here is Euler's
identity:

$$
\begin{equation}
e^{i\pi} + 1 = 0
\end{equation}
$$

. . .

And here is Shepherd's lemma:

$$
\begin{equation}
\frac{P_1 - P_2}{Q_1 - Q_2} > \frac{P_1 - P_3}{Q_1 - Q_3}
\end{equation}
$$

## Images

Adding images is easy, simply type
`![Photo Description](path\to\image)`, et voilà!

![](https://cdn.pixabay.com/photo/2019/06/21/19/27/switzerland-4290226_960_720.jpg)

Source:
[Link](https://cdn.pixabay.com/photo/2019/06/21/19/27/switzerland-4290226_960_720.jpg)

## Background image {background-image="images/train.jpg"}

[Source:
[Link](https://cdn.pixabay.com/photo/2012/10/25/23/18/train-62849_960_720.jpg)]{.absolute
bottom="0" left="0"}

# Some concerns {background-color="#07202E" background-opacity="0.8"}

## Tabset example

::: panel-tabset
## Example 1

Content here for tabset 1 :)

## Example 2

More content here, for tabset 2 :)
:::

## Incremental content

Hi!

. . .

Use `. . .` to separate content as an incremental slide!

## You can add R code to plot data...

```{r first_plot}
#| echo: true
g <- starwars |>
  ggplot() +
  geom_point(aes(x = height, y = mass)) +
  theme_dime()
```

## You can add R code to plot data...and focus on (a) specific line(s):

```{r}
#| echo: true
#| code-line-numbers: "4-6"
starwars <- starwars |>
  dplyr::mutate(name = ifelse(name %in% c("Jabba Desilijic Tiure", "Tarfful"),
                              name, ""))

g <- starwars |>
  ggplot() +
  geom_point(aes(x = height, y = mass, col = sex)) +
  ggrepel::geom_text_repel(aes(x = height,
                               y = mass,
                               label = name),
                           max.overlaps = 100) +
  labs(title = "Star Wars Example",
       caption = "Star Wars Example Dataset",
       col = "Sex") +
  theme_dime()
```

> See the [Quarto Documentation for more
> details.](https://quarto.org/docs/presentations/revealjs/#code-blocks)

## Before showing the results :)

```{r}
#| fig.align: center
#| echo: true
g
```

## A DIME color palette

The theme also contains a DIME/World Bank color palette and a color
generator to make graphs more uniform and easier to generate.
`dime_palette()` yields a named vector with the HEX codes of the
corresponding colors for an easy integration in `{ggplot2}` graphs.

```{r}
#| fig.align: center
#| echo: true
#| fig-height: 1.5
# The default discrete DIME color palette
dime_palette(name = "DIME", 5, type = "discrete")

# A continuous palette based on the DIME palette
dime_palette(name = "DIME", 21, type = "continuous")
```

## A few more penguin examples {.scrollable}

Let's create a few more plots using the great `{palmerpenguins}` dataset
and illustrate Simpson's Paradox. These examples are inspired by [this
great talk](https://apreshill.github.io/palmerpenguins-useR-2022).

::::: columns
::: {.column width="50%"}
```{r}
#| fig.align: center
#| echo: false

penguins <- palmerpenguins::penguins

penguins |>
  ggplot(aes(bill_length_mm, bill_depth_mm)) +
  geom_point() +
  geom_smooth(method = lm,
              formula = y ~ x,
              se = F) +
  labs(title = "Palmer Penguins: Simpson's Paradox",
       caption = "Palmer Penguins Dataset",
       x = "Bill Length (mm)",
       y = "Bill Depth (mm)",
       col = "Species") +
  theme_dime()
```
:::

::: {.column width="50%"}
```{r}
#| fig.align: center
#| echo: false

penguins <- palmerpenguins::penguins

penguins |>
  ggplot(aes(bill_length_mm, bill_depth_mm, col = species)) +
  geom_point() +
  geom_smooth(method = lm,
              formula = y ~ x,
              se = F) +
  ggpubr::stat_regline_equation(
    aes(label =  paste(..eq.label.., ..adj.rr.label.., sep = "~~~~")),
    formula = formula
  ) +
  labs(title = "Palmer Penguins: Simpson's Paradox",
       caption = "Palmer Penguins Dataset",
       x = "Bill Length (mm)",
       y = "Bill Depth (mm)",
       col = "Species") +
  theme_dime()
```
:::
:::::

## Creating interactive graphs with Observable JS {.scrollable .small}

Another way of creating interactive visualizations within your
presentations is to use [Observable JS](https://observablehq.com/), a
Java Script framework developed by the creators of
[D3.js](https://d3js.org/). See the [Quarto
documentation](https://quarto.org/docs/interactive/ojs/) for more
details.

```{ojs}
data = FileAttachment("data/palmer-penguins.csv").csv({ typed: true })
```

```{ojs}
//| panel: sidebar

// Function to filter data
filtered = data.filter(function(penguin) {
  return bill_length_min < penguin.bill_length_mm &&
         islands.includes(penguin.island);
})

viewof bill_length_min = Inputs.range(
  [32, 50],
  {value: 35, step: 1, label: "Bill length (min):"}
)
viewof islands = Inputs.checkbox(
  ["Torgersen", "Biscoe", "Dream"],
  { value: ["Torgersen", "Biscoe"],
    label: "Islands:"
  }
)
```

```{ojs}
Plot.rectY(filtered,
  Plot.binX(
    {y: "count"},
    {x: "body_mass_g", fill: "species", thresholds: 20}
  ))
  .plot({
    facet: {
      data: filtered,
      x: "sex",
      y: "species",
      marginRight: 80
    },
    marks: [
      Plot.frame(),
    ]
  }
)
```

## Penguin regression tables

::::: {.columns .vh-center-container}
::: {.column width="40%"}
$$
\text{Bill Depth}_{i} = \alpha + \beta \times \text{Bill Length}_{i} + \epsilon_{i}
$$

```{r}
#| fig.align: center
#| echo: false

fullmodel <- lm(bill_depth_mm ~ bill_length_mm, penguins)
huxtable::huxreg(fullmodel) |>
  huxtable::set_font_size(11) # Smaller font size to fit on slide
```
:::

::: {.column width="40%"}
$$
\text{Bill Depth}_{i, k} = \alpha_{k} + \beta_{k} \times \text{Bill Length}_{k, i} + \epsilon_{i} \\
\text{where } k = \text{Gentoo}
$$

```{r}
#| fig.align: center
#| echo: false

gentoomodel <- lm(bill_depth_mm ~ bill_length_mm,
                  dplyr::filter(penguins, species == "Gentoo"))
huxtable::huxreg(gentoomodel) |>
  huxtable::set_font_size(11) # Smaller font size to fit on slide
```
:::
:::::

## What about other tables? {.smaller}

### `knitr::kable()`

::::: {.columns .h-center-container}
::: {.column width="45%"}
```{r}
#| label: kable-ex
#| echo: true
#| eval: false
tab <- starwars |>
  tidyr::drop_na(species) |>
  group_by(species) |>
  summarise(
    n = n(),
    mean_heigth = round(mean(height, na.rm = TRUE)),
    mean_mass = round(mean(mass, na.rm = TRUE))
  ) |>
  slice_max(order_by = n, n = 4)

knitr::kable(tab)
```
:::

::: {.column width="45%"}
```{r}
#| label: kable-ex
#| eval: true
```
:::
:::::

## `DT::datatable()` {.smaller}

With the `smaller` class in the slide! Ex: `## slide name {.smaller}`

```{r}
DT::datatable(tab, options = list(pageLength = 5))
```

## `gt::gt()`

```{r}
gt::gt(tab)
```

## `reactable::reactable()`

```{r}
reactable::reactable(tab)
```

# Simulation and visualisation {background-color="#07202E"}

## Simulation Settings (N=200) {.smaller}

-   **Sample & Scale:**
    -   Groups: Germany (`g`, $n=100$) \| Namibia (`n`, $n=100$).
    -   Scale: 30 items (10 per domain), 4-point Likert, **RSM (acat)**
        logic.
-   **Latent Structure (Traits):**
    -   Domains: **L** (Linguistics), **S** (Social), **P**
        (Professional).
    -   Consistency: $\rho = 0.6$ for same traits across domains.
    -   **Conflicts (**$a$ vs $r$): $L = -0.2$ \| $S = -0.5$ \|
        $P = -0.8$ (highest tension).
-   **Group `n` (Namibia) Specifics:**
    -   **Trait Shift:** Autonomy (`a`) -0.5; Relatedness (`r`) +0.5.
    -   **Response Bias:** Added systematic **+0.6 "optimism bias"**.
    -   **Group `g` (Germany) Specifics:**
    -   **Trait Shift:** Autonomy (`a`) +0.5; Relatedness (`r`) -0.5.
-   **Item Distribution:**
    -   5 positive coding (**a**) and 5 negative coding (**r**) items
        per domain.


## Simulation via `brms`

::: panel-tabset


### Simulated data example

```{r}
#| echo: false
#| message: false
#| warning: false

read_csv("data/simdata.csv") %>%
  slice_sample(n = 6) %>%
  arrange(ID, Domain) %>%
  kable(align = "c")
```

### Base model

```{r}
#| echo: true
#| eval: true

fit <- brm(
  formula = resp ~ 1 + comm + (0 + dim_a + dim_r | ID) + (1 | item),
  data = simdata,
  family = brmsfamily("acat", "logit"), 
  prior = c(
    prior(normal(0, 3), class = "b"), 
    prior(normal(0, 1), class = "sd"),
    prior(lkj(2), class = "cor")
  ),
  backend = "cmdstanr", chains = 4, iter = 2000, warmup = 1000, cores = 4,
  file = "models/fit_rsm"
)

```

### Model summary

```{r}
summary (fit)
```

:::

## Visualise the base model 

```{=html}
<style>
.quarto-figure figcaption {
  margin-top: -1.5em;
  line-height: 1.2;
}
</style>
```

::: panel-tabset

### Wright map

![**Figure 1: Wright map.** Results from the Bayesian 1PL RSM. The leftmost panel displays item difficulty estimates across the three domains (L, S, P). The two rightmost panels highlight the community-level trait differences.](figures/fig_rsm_recovery.png){width="75%" fig-align="center"}

### Group Comparison

![**Figure 2: Community Effects.** Conditional effects of Community. The left plot shows the predicted mean response. The right plot displays category-wise probabilities (1–4), demonstrating how the **+0.6 optimism bias** in group $N$ shifts responses toward higher categories.](figures/fig_comm_effects.png){width="75%" fig-align="center"}
:::

## Advance model specification

::: panel-tabset

### Advance model

```{r}
#| echo: true
#| eval: true

fit_sep <- brm(
 formula = resp ~ 1 + comm + (0 + Domain:dim_a + Domain:dim_r | ID) + (1 | item),
  data = simdata,
  family = brmsfamily("acat", "logit"), 
  prior = c(
    prior(normal(0, 1), class = "sd"),
    prior(lkj(2), class = "cor")
  ),
  chains = 4, iter = 2000, warmup = 1000, cores = 4, backend = "cmdstanr",
  file = "models/fit_sep_dim"
)
```

### Model summary 

```{r}
summary(fit_sep)

```


:::

## Visualise advance model
```{=html}
<style>
.quarto-figure figcaption {
  margin-top: -1.5em;
  line-height: 1.2;
}
</style>
```

::: panel-tabset

### Domain Correlations

![**Figure 3: Domain-specific latent correlations.** Scatter plots illustrating the relationship between Autonomy ($a$) and Relatedness ($r$) across Linguistics (L), Social (S), and Professional (P) domains. Dashed lines represent the linear regressions of the recovered core conflicts, while point shapes distinguish between the German ($G$) and Namibian ($N$) communities.](figures/fig_sep_scatter.png){width="75%" fig-align="center"}

### Correlation Matrix

![**Figure 4: Latent correlation matrix ($\Phi$) recovery.** Heatmaps comparing the posterior mean estimates (left) against the target truth values (right) for the $6 \times 6$ latent structure. The model effectively recovers the simulated correlations.](figures/fig_phi_heatmap.png){width="75%" fig-align="center"}

:::

## References

::: {#refs}
:::
